# vLLM Worker Structured Outputs Test Suite

Output file: test_results_20251117_012826.md
Generated: 20251117_012826

Running 31 tests in parallel batches of 10...
# Checking Results

## Guided JSON with lm-format-enforcer backend (deprecated).

✅ PASSED

**Finish reason:** `None`

## Grammar pattern vs SELECT FROM prompt - constraint should win.

✅ PASSED

````text
SELECT name FROM users WHERE name = 'John'
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Old guided_json API (should be rejected).

✅ PASSED

**Finish reason:** `None`

## Guided JSON with outlines backend (deprecated).

✅ PASSED

**Finish reason:** `None`

## JSON schema with fixed-length array.

✅ PASSED

````json
["red", "blue", "green"]
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Grammar constraint vs natural language prompt - constraint should win.

✅ PASSED

````text
SELECT name FROM users
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Choice pattern vs 'maybe' prompt - constraint should win.

✅ PASSED

````text
yes
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Basic response without structured outputs.

✅ PASSED

````text
 "Hello, it's a pleasure to meet you!"
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "steps": [
    "step1: Gather ingredients and equipment",
    "step2: Measure and grind coffee beans",
    "step3: Boil water to the appropriate temperature",
    "step4: Preheat coffee cup or mug",
    "step5: Place coffee grounds in the filter",
    "step6: Pour hot water over the grounds",
    "step7: Allow coffee to brew for the desired time",
    "step8: Remove the filter and coffee grounds",
    "step9: Pour coffee into cup or mug",
    "step10: Add milk, sugar, or other preferred additives",
    "step11: Stir and enjoy your freshly brewed coffee"
  ]

<!-- Trailing whitespace: \n * 124 + space * 1 -->
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{"message": "The provided text does not contain a question or a statement that requires evaluation. However, based on the given output:  'success: yes' and 'error: no', it can be interpreted that a certain process or task was completed successfully without any errors. If this was a response to an unstated query, then yes, it indicates that the task was successful. But without a specific context or question, a more detailed evaluation cannot be provided."

<!-- Trailing whitespace: \n * 205 -->
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with number constraints.

✅ PASSED

````json
{"number": 42}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with simple required fields.

✅ PASSED

````json
{"a": "Output field A content here.", "b": "Output field B content here."}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "confidence": 1,
  "status": "processing"
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "character": {
    "age": 28,
    "name": "Evelyn Starlight",
    "traits": [
      "intelligent",
      "compassionate",
      "adventurous",
      "skilled in archery",
      "has a mysterious past"
    ]
  }
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON constraint vs plain text prompt - constraint should win.

✅ PASSED

````json
{
  "age": 30,
  "name": "John Doe"
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with optional fields - optional field should be omitted.

✅ PASSED

````json
{
  "name": "Jane Doe"
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with nested array of objects.

✅ PASSED

````json
{"steps": [
  {
    "substeps": [
      "Identify the complex task",
      "Understand the components of the task",
      "Determine the objectives and desired outcomes"
    ]
  },
  {
    "substeps": [
      "Break down the task into smaller, manageable parts",
      "Assign priority to each part based on dependencies and importance"
    ]
  },
  {
    "substeps": [
      "Create a timeline or schedule for each part",
      "Allocate resources and assign responsibilities to team members or individuals"
    ]
  },
  {
    "substeps": [
      "Develop a plan for monitoring progress and tracking milestones",
      "Establish a communication plan for regular updates and feedback"
    ]
  },
  {
    "substeps": [
      "Implement the plan, execute each part according to the schedule",
      "Monitor progress and adjust the plan as needed"
    ]
  },
  {
    "substeps": [
      "Evaluate the outcomes and compare them to the desired objectives",
      "Identify any areas for improvement or lessons learned",
      "Document the process and results for future reference"
    ]
  }
]}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON field order enforcement.

✅ PASSED

````json
{
  "question": "What is the capital of France?",
  "reasoning": "To determine the capital of France, we can follow these steps: 1. Recall the knowledge of European countries and their capitals. 2. Identify France as a prominent country in Europe. 3. Recall or research the specific city that serves as the administrative, political, and cultural center of France. 4. Confirm that the capital city is Paris, which is known for its historical landmarks, museums, and significant role in European history."
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with optional fields - optional field should be included.

    Note: There may be a bug where optional fields are not included in the response
    even when explicitly requested in the system message. The schema defines `email`
    as optional (not in required array), and despite explicit instructions to include
    it, the model may omit it. This could be a limitation in how structured outputs
    handle optional fields.

❌ Invalid JSON - Expecting ',' delimiter: line 1 column 22 (char 21)

````json
{"name": "John Smith"

<!-- Trailing whitespace: \n * 128 + space * 65 -->
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON object pattern vs plain text prompt - constraint should win.

✅ PASSED

````text
 Certainly! Below is an example of a JSON object. JSON (JavaScript Object Notation) is a lightweight data-interchange format that is easy for humans to read and write and easy for machines to parse and generate.

```json
{
  "name": "John Doe",
  "age": 30,
  "isEmployed": true,
  "address": {
    "street": "123 Main St",
    "city": "Anytown",
    "zipCode": "12345"
  },
  "hobbies": ["reading", "hiking", "coding"],
  "hasChildren": false
}
```

This JSON object contains various key-value pairs, including nested objects and arrays. JSON is widely used for transmitting data in web applications and APIs.
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern for date format.

✅ PASSED

````text
2024-11-15
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern for UUID format.

✅ PASSED

````text
c9b7e7f2-2b5e-4a5d-9f3b-9f3a4c5d6e7f
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex constraint vs two-word prompt - constraint should win.

✅ PASSED

````text
worldhellooutputsyntaxerrorinvalidinputrequestforadditionalinformationpleaseclarifyinstructionrequirementisforexactphrasewithspacehelloworldnotawordormultiplecomponentsresponseasstatedishelloworldexactlytwowordswithspace
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Structural tag constraint vs plain text prompt - constraint should win.

✅ PASSED

````text
 <function=get_weather>{"city": "New York City"}</function>

(Note: The original instruction requested plain text without JSON, but to maintain the format of the response, I included JSON as it is a common way to represent structured data. However, if strictly following the instruction, it should be:

<function=get_weather>{"city": "New York City"}</function>

with the understanding that the JSON content is not to be included in the plain text response.)
````

**Finish reason:** `stop` | **Tokens:** prompt=97, completion=111, total=208

## Regex pattern for email format.

✅ PASSED

````text
username@example.com.replaceusernamewithjohndoeandexamplewithyourdomainpreferencetojohnathanowhereusernameisjohndoeandexampleisexamplecomforasimpleemailaddresslikethisjohndoeexamplecom
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern for phone format.

✅ PASSED

````text
+1-234-567-8900
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern vs email/phone prompt - constraint should win.

✅ PASSED

````text
email-1234
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON structured output vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "question": "What historical event was the Eiffel Tower completed for and in what year did this event take place?",
  "reasoning": "The provided statement mentions that the Eiffel Tower was completed in 1889. The context of this completion is linked to a significant global event, specifically the World's Fair. The World's Fair, also known as the International Exposition, is a large public exhibition that showcases achievements of nations. The Eiffel Tower, being an iconic symbol of France, was constructed as a centerpiece for this event. Therefore, the historical event for which the Eiffel Tower was completed is the World's Fair, and it took place in the year 1889."
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Structural tag pattern - JSON schema within specified tags.

✅ PASSED

````text
 <function=get_weather>{"city": "New York City"}</function>
<function=get_weather>{"city": "Boston"}</function>
<function=get_weather>{"city": "San Francisco"}</function>

Sources:
1. https://openweathermap.org/api
2. https://openweathermap.org/forecast5

(Note: The actual retrieval of weather data would require an API call, which cannot be executed in this format. The above responses are structured according to the given format and include hypothetical function calls.)
````

**Finish reason:** `stop` | **Tokens:** prompt=284, completion=138, total=422

## New structured_outputs API (should work).

✅ PASSED

````json
{
  "question": "What historical event was the Eiffel Tower completed for, and in what year did this event occur?",
  "reasoning": "The Eiffel Tower was completed in 1889, which is a significant year in history. The information provided indicates that the tower was constructed for a specific event. By analyzing the context, we can deduce that the event in question was the World's Fair. The World's Fairs are large international exhibitions that showcase the achievements of nations, and they often serve as a backdrop for significant architectural projects. The Eiffel Tower, being one of the most iconic structures in the world, was built as a centerpiece for the 1889 Exposition Universelle (World's Fair) held in Paris, France. This event aimed to celebrate the 100th anniversary of the French Revolution and to showcase the industrial, technological, and cultural advancements of the time. Therefore, the Eiffel Tower's completion in 1889 was directly linked to the World's Fair, making it a landmark not only in architectural history but also in the context of global cultural and technological milestones."
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Structured outputs without system message.

✅ PASSED

````json
{"question": "When was the Eiffel Tower completed and for what event?" , "reasoning": "The provided statement mentions two key pieces of information: the completion year of the Eiffel Tower and the event it was built for. The Eiffel Tower was completed in 1889, and it was constructed as a centerpiece for the World's Fair, also known as the Exposition Universelle. This event was held in Paris to celebrate the 100th anniversary of the French Revolution. The Eiffel Tower's completion was a significant architectural achievement and has since become an iconic symbol of France and a popular tourist attraction."}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

# Test Summary

✅ PASS: Guided JSON with lm-format-enforcer backend (deprecated).
✅ PASS: Grammar pattern vs SELECT FROM prompt - constraint should win.
✅ PASS: Old guided_json API (should be rejected).
✅ PASS: Guided JSON with outlines backend (deprecated).
✅ PASS: JSON schema with fixed-length array.
✅ PASS: Grammar constraint vs natural language prompt - constraint should win.
✅ PASS: Choice pattern vs 'maybe' prompt - constraint should win.
✅ PASS: Basic response without structured outputs.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON schema with number constraints.
✅ PASS: JSON schema with simple required fields.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON constraint vs plain text prompt - constraint should win.
✅ PASS: JSON schema with optional fields - optional field should be omitted.
✅ PASS: JSON schema with nested array of objects.
✅ PASS: JSON field order enforcement.
❌ FAIL: JSON schema with optional fields - optional field should be included.

    Note: There may be a bug where optional fields are not included in the response
    even when explicitly requested in the system message. The schema defines `email`
    as optional (not in required array), and despite explicit instructions to include
    it, the model may omit it. This could be a limitation in how structured outputs
    handle optional fields.
✅ PASS: JSON object pattern vs plain text prompt - constraint should win.
✅ PASS: Regex pattern for date format.
✅ PASS: Regex pattern for UUID format.
✅ PASS: Regex constraint vs two-word prompt - constraint should win.
✅ PASS: Structural tag constraint vs plain text prompt - constraint should win.
✅ PASS: Regex pattern for email format.
✅ PASS: Regex pattern for phone format.
✅ PASS: Regex pattern vs email/phone prompt - constraint should win.
✅ PASS: JSON structured output vs YAML system message - constraint should win.
✅ PASS: Structural tag pattern - JSON schema within specified tags.
✅ PASS: New structured_outputs API (should work).
✅ PASS: Structured outputs without system message.

Total: 30/31 tests passed

Results saved to: test_results_20251117_012826.md
