# vLLM Worker Structured Outputs Test Suite

Output file: test_results_20251118_000242.md
Generated: 20251118_000242

Running 35 tests in parallel batches of 10...
# Checking Results

## Grammar constraint vs natural language prompt - constraint should win.

✅ PASSED

````text
SELECT name FROM users
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Basic response without structured outputs.

✅ PASSED

````text
 "Hello, it's a pleasure to meet you!"
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Guided JSON with outlines backend (deprecated).

✅ PASSED

**Finish reason:** `None`

## JSON schema with fixed-length array.

✅ PASSED

````json
["red", "blue", "green"]
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Guided JSON with lm-format-enforcer backend (deprecated).

✅ PASSED

**Finish reason:** `None`

## Grammar pattern vs SELECT FROM prompt - constraint should win.

✅ PASSED

````text
SELECT name FROM users WHERE name = 'John'
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Old guided_json API (should be rejected).

✅ PASSED

**Finish reason:** `None`

## Choice pattern vs 'maybe' prompt - constraint should win.

✅ PASSED

````text
yes
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "steps": [
    "step1: Gather ingredients and equipment",
    "step2: Measure and grind coffee beans",
    "step3: Boil water to the appropriate temperature",
    "step4: Preheat coffee cup or mug",
    "step5: Place coffee grounds in the filter",
    "step6: Pour hot water over the coffee grounds",
    "step7: Allow coffee to brew for the desired time",
    "step8: Remove the coffee filter and cup",
    "step9: Add milk, sugar, or other desired additives",
    "step10: Stir and enjoy your freshly brewed coffee"
  ]

<!-- Trailing whitespace: \n * 138 + space * 1 -->
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{"message": "The provided text appears to be a structured response indicating a successful operation with no errors. The output is formatted as YAML (Yet Another Markup Language), which is often used for configuration files and data exchange. The keys 'success' and 'error' are set to 'yes' and 'no', respectively, which confirms that the operation was successful and there were no errors encountered. Therefore, based on this structured response, it can be evaluated that the operation worked as intended."

<!-- Trailing whitespace: \n * 196 -->
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "character": {
    "age": 28,
    "name": "Evelyn Starlight",
    "traits": [
      "intelligent",
      "compassionate",
      "adventurous",
      "skilled in archery",
      "has a mysterious past"
    ]
  }
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON constraint vs plain text prompt - constraint should win.

✅ PASSED

````json
{
  "age": 30,
  "name": "John Doe"
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "confidence": 1,
  "status": "processing"
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with number constraints.

✅ PASSED

````json
{"number": 42}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with optional fields - optional field should be omitted.

✅ PASSED

````json
{
  "name": "Jane Doe"
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON constraint vs multiple special characters request - constraint should enforce valid JSON.

✅ PASSED

````json
{"text": "line1\nline2 with \"quotes\" and C:\\path\to\file\twith tabs"}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON field order enforcement.

✅ PASSED

````json
{
  "question": "What is the capital of France?",
  "reasoning": "To determine the capital of France, we can follow these steps: 1. Recall the knowledge of European countries and their capitals. 2. Identify France as a prominent country in Europe. 3. Recall or research the specific city that serves as the administrative, political, and cultural center of France. 4. Confirm that the capital city is Paris, which is known for its historical landmarks, museums, and significant role in global affairs."
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with optional fields - optional field should be included.

    Note: There may be a bug where optional fields are not included in the response
    even when explicitly requested in the system message. The schema defines `email`
    as optional (not in required array), and despite explicit instructions to include
    it, the model may omit it. This could be a limitation in how structured outputs
    handle optional fields.

❌ Invalid JSON - Expecting ',' delimiter: line 1 column 22 (char 21)

````json
{"name": "John Smith"

<!-- Trailing whitespace: \n * 128 + space * 65 -->
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with nested array of objects.

✅ PASSED

````json
{"steps": [
  {
    "substeps": [
      "Identify the complex task",
      "Understand the components of the task",
      "Break down the task into smaller, manageable parts",
      "Prioritize the parts based on importance and dependencies",
      "Create a detailed plan or checklist for each part",
      "Assign responsibilities or resources if necessary",
      "Set deadlines and milestones for each part",
      "Begin working on the first part",
      "Monitor progress and adjust the plan as needed",
      "Complete each part and move on to the next",
      "Review the completed parts to ensure they meet the desired outcome",
      "Evaluate the overall task completion and make any necessary adjustments"
    ]
  }
]
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON object pattern vs plain text prompt - constraint should win.

✅ PASSED

````text
 Certainly! Below is an example of a JSON object:

```json
{
  "name": "John Doe",
  "age": 30,
  "isEmployed": true,
  "address": {
    "street": "123 Main St",
    "city": "Anytown",
    "zipCode": "12345"
  },
  "hobbies": ["reading", "hiking", "coding"],
  "hasPet": {
    "type": "dog",
    "name": "Fido"
  }
}
```

This JSON object includes a variety of data types, such as strings, numbers, booleans, nested objects, and an array. JSON (JavaScript Object Notation) is a lightweight data-interchange format that is easy for humans to read and write and easy for machines
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern for date format.

✅ PASSED

````text
2024-11-15
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON schema with simple required fields.

✅ PASSED

````json
{"a": "Output field A content here.", "b": "Output field B content here."}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON constraint vs unescaped quotes request - constraint should enforce valid JSON.

✅ PASSED

````json
{"quote": "hello"}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex constraint vs two-word prompt - constraint should win.

✅ PASSED

````text
worldhellooutputsyntaxerrorinvalidinputrequestforadditionalinformationpleaseclarifyyourinstructionrequirementisforexactoutputoftwowordswithaplaceholderhelloworldwithoutadditionaltextorsyntaxindicateserrorincompliancewith
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern vs email/phone prompt - constraint should win.

✅ PASSED

````text
email-1234
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern for email format.

✅ PASSED

````text
username@example.com.replaceusernamewithjohndoeandexamplewithyourdomainpreferencetojohnDoeExamplecomorsimilarlyjohnDoeEmailcombasedonyourdomainchoiceforasimpleemailaddresslikethisjohn
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Regex pattern for phone format.

✅ PASSED

````text
+1-234-567-8900
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON constraint vs unescaped backslashes request - constraint should enforce valid JSON.

✅ PASSED

````json
{"path": "C:\u005CUsers\u005CDocuments"}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON constraint vs unescaped newlines request - constraint should enforce valid JSON.

✅ PASSED

````json
{"description": "This is the first line\nThis is the second line\nThis is the third line"}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## JSON structured output vs YAML system message - constraint should win.

✅ PASSED

````json
{
  "question": "What historical event was the Eiffel Tower completed for, and in what year did this occur?",
  "reasoning": "The provided statement mentions that the Eiffel Tower was completed in 1889. It also specifies that this completion was for a significant event, the World's Fair. The World's Fair, also known as the International Exposition, is a large public exhibition that showcases achievements of nations. In this context, the Eiffel Tower was constructed as a centerpiece for the 1889 Exposition Universelle in Paris, France, which celebrated the 100th anniversary of the French Revolution. This information allows us to understand the historical significance of the Eiffel Tower's completion and its association with the World's Fair."
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Structural tag pattern - JSON schema within specified tags.

✅ PASSED

````text
 <function=get_weather>{"city": "New York City"}</function>
<function=get_weather>{"city": "Boston"}</function>
<function=get_weather>{"city": "San Francisco"}</function>

Sources:
1. https://openweathermap.org/api
2. https://openweathermap.org/forecast5

(Note: To actually retrieve the weather, you would need to make API calls to a weather service like OpenWeatherMap, as the function provided is a hypothetical example.)
````

**Finish reason:** `stop` | **Tokens:** prompt=284, completion=132, total=416

## New structured_outputs API (should work).

✅ PASSED

````json
{
  "question": "What historical event was the Eiffel Tower completed for, and in what year did this occur?",
  "reasoning": "The Eiffel Tower was completed in 1889, which is a significant year in history. The completion of this iconic structure was specifically for the World's Fair, also known as the Exposition Universelle. The World's Fair is an international exhibition that showcases the achievements of nations, and the Eiffel Tower was a centerpiece of this event. The fair was held in Paris, France, and aimed to celebrate the 100th anniversary of the French Revolution. The Eiffel Tower's construction began in 1887 and was completed in 1889, making it a symbol of French engineering prowess and a lasting legacy of the World's Fair."
}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Structural tag constraint vs plain text prompt - constraint should win.

✅ PASSED

````text
 <function=get_weather>{"city": "New York City"}</function>

(Note: The original instruction requested plain text without JSON, but to maintain the integrity of the response, I've included a JSON format as it's a common way to represent structured data. However, if strictly following the original instruction, it would be:

<function=get_weather>{"city": "New York City"}</function>

which is not valid JSON but a representation of the data structure that could be used within a JSON context.)
````

**Finish reason:** `stop` | **Tokens:** prompt=97, completion=120, total=217

## Regex pattern for UUID format.

✅ PASSED

````text
c9b7e9f8-5f2d-4d0a-9f3b-8a8c2a8f6f3e
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

## Structured outputs without system message.

✅ PASSED

````json
{"question": "When was the Eiffel Tower completed and for what event?" , "reasoning": "The given statement provides specific information about the completion date and the event for which the Eiffel Tower was built. The completion date is mentioned as 1889, and the event is identified as the World's Fair. This information allows for a clear and direct answer to the question."}
````

**Finish reason:** `None` | **Tokens:** prompt=0, completion=0, total=0

# Test Summary

✅ PASS: Grammar constraint vs natural language prompt - constraint should win.
✅ PASS: Basic response without structured outputs.
✅ PASS: Guided JSON with outlines backend (deprecated).
✅ PASS: JSON schema with fixed-length array.
✅ PASS: Guided JSON with lm-format-enforcer backend (deprecated).
✅ PASS: Grammar pattern vs SELECT FROM prompt - constraint should win.
✅ PASS: Old guided_json API (should be rejected).
✅ PASS: Choice pattern vs 'maybe' prompt - constraint should win.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON constraint vs plain text prompt - constraint should win.
✅ PASS: JSON schema vs YAML system message - constraint should win.
✅ PASS: JSON schema with number constraints.
✅ PASS: JSON schema with optional fields - optional field should be omitted.
✅ PASS: JSON constraint vs multiple special characters request - constraint should enforce valid JSON.
✅ PASS: JSON field order enforcement.
❌ FAIL: JSON schema with optional fields - optional field should be included.

    Note: There may be a bug where optional fields are not included in the response
    even when explicitly requested in the system message. The schema defines `email`
    as optional (not in required array), and despite explicit instructions to include
    it, the model may omit it. This could be a limitation in how structured outputs
    handle optional fields.
✅ PASS: JSON schema with nested array of objects.
✅ PASS: JSON object pattern vs plain text prompt - constraint should win.
✅ PASS: Regex pattern for date format.
✅ PASS: JSON schema with simple required fields.
✅ PASS: JSON constraint vs unescaped quotes request - constraint should enforce valid JSON.
✅ PASS: Regex constraint vs two-word prompt - constraint should win.
✅ PASS: Regex pattern vs email/phone prompt - constraint should win.
✅ PASS: Regex pattern for email format.
✅ PASS: Regex pattern for phone format.
✅ PASS: JSON constraint vs unescaped backslashes request - constraint should enforce valid JSON.
✅ PASS: JSON constraint vs unescaped newlines request - constraint should enforce valid JSON.
✅ PASS: JSON structured output vs YAML system message - constraint should win.
✅ PASS: Structural tag pattern - JSON schema within specified tags.
✅ PASS: New structured_outputs API (should work).
✅ PASS: Structural tag constraint vs plain text prompt - constraint should win.
✅ PASS: Regex pattern for UUID format.
✅ PASS: Structured outputs without system message.

Total: 34/35 tests passed

Results saved to: test_results_20251118_000242.md
